@namespace Orions.Systems.CrossModules.Components

@inherits BaseBlazorComponent<ReportVm>

@using Orions.Infrastructure.HyperMedia

<div class="widget-content-report-grid">

    @if (DataContext.Report != null && DataContext.IsLoadedReportResult)
    {
        @if (Widget.ShowTitle)
        {
            <h3>@DataContext.Report.Report.Name</h3>
        }

        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        @foreach (var column in DataContext.Report.Data.ColumnsDefinitions)
                        {
                            <th scope="col">@column.Title</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var rows in DataContext.Report.Data.RowsCells)
                    {
                        <tr>
                            @foreach (var row in rows)
                            {
                                <td>@row.ToString()</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if(Widget.ShowFooter){
            <div class="widget-content-report-grid-footer">
                <div class="">Created at @DataContext.Report.CreatedAtUTC</div>
            </div>
        }
    }

    @if (!DataContext.IsLoadedReportResult)
    {
        <div style="position:relative;">
            <div class="loading-bar"></div>
        </div>
    }

</div>

@code {

    [Parameter]
    public ReportGridWidget Widget { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var netStore = await NetStore.ConnectAsyncThrows("http://localhost:5580/Execute");
        DataContext.InitStore(netStore);

        await DataContext.LoadReportResultData(Widget.ReportResultId, Widget.MetadatasetId);

        await base.OnInitializedAsync();
    }
}

<style>
    .widget-content-report-grid {
        /*background-color: rgba(55, 152, 55, 0.20);*/
        padding: 15px;
        overflow: hidden;
    }

        .widget-content-report-grid h3 {
            text-align: center;
        }

    .widget-content-report-grid-footer {
        font-size:12px;
        font-style:italic;
    }
</style>
