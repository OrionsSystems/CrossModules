@namespace Orions.Systems.CrossModules.Components

@inherits DashboardComponent<ReportGridVm, ReportGridWidget>

@using Orions.Infrastructure.Reporting

<div class="widget-content-report">

	@if (Vm.Report != null && Vm.IsLoadedReportResult)
	{
		var rowIndex = 0;

		@if (Widget.ShowTitle)
		{
			<h3>@Widget.Label</h3>
		}

		<div class="widget-content-report-view">

			<div class="table-responsive">
				<table class="table table-striped table-bordered table-hover">
					<thead>
						<tr>
							<th scope="col"></th>
							@foreach (var column in Vm.Report.Data.ColumnsDefinitions)
							{
								<th scope="col">@column.Title</th>
							}
						</tr>
					</thead>
					<tbody>
						@foreach (var rows in Vm.Report.Data.RowsCells)
						{
							var rowDef = Vm.Report.Data.RowsDefinitions[rowIndex];
							var rowTitle = rowDef.Title;
							var rowDate = ReportData.ParseTimePosition(rowTitle);
							rowIndex++;

							@if (rowDate.HasValue)
							{
							<tr>
								<td>@rowDate.Value.ToString("dd MMM HH:mm")</td>
								@foreach (var row in rows)
								{
									<td>@row.ToString()</td>
								}
							</tr>
							}
						}
					</tbody>
				</table>
			</div>

		</div>
		@if (Widget.ShowFooter)
		{
			<div class="widget-content-report-footer">
				@if (Vm.ReportHasName)
				{
					<div class="widget-content-report-footer-name">@Vm.ReportName</div>
				}
				<div class="widget-content-report-footer-create">Created at @Vm.Report.CreatedAtUTC</div>
			</div>
		}
	}

	@if (Vm.Report == null && Vm.IsLoadedReportResult)
	{
		<div class="widget-missing-report">
			Missing report data!
		</div>
	}

	@if (!Vm.IsLoadedReportResult)
	{
		<div style="position:relative;">
			<div class="loading-bar"></div>
		</div>
	}

</div>

@code {

	protected override async Task OnInitializedAsync()
	{
		await Vm.RefreshReportResultData();

		await base.OnInitializedAsync();
	}
}
