@namespace Orions.Systems.CrossModules.Components

@using Orions.Infrastructure.HyperMedia
@using Orions.Node.Common

@inherits DashboardComponent<ReportGridVm, ReportGridWidget>

<div class="widget-content-report-grid">

    @if (Vm.Report != null && Vm.IsLoadedReportResult)
	 {
		 var rowIndex = 0;

        @if (Widget.ShowTitle && Vm.ReportHasName)
        {
            <h3>@Vm.ReportName</h3>
        }

        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th scope="col"></th>
                        @foreach (var column in Vm.Report.Data.ColumnsDefinitions)
                        {
                            <th scope="col">@column.Title</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var rows in Vm.Report.Data.RowsCells)
                    {
                       var rowDef = Vm.Report.Data.RowsDefinitions[rowIndex];
                       var rowTitle = rowDef.Title;
                       var rowDate = ReportWidgetVm<ReportGridWidget>.ParseTimePosition(rowTitle);
                       rowIndex++;

                        <tr>
                            <td>@rowDate.ToString("dd MMM HH:mm")</td>
                            @foreach (var row in rows)
                            {
                                <td>@row.ToString()</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (Widget.ShowFooter)
        {
            <div class="widget-content-report-grid-footer">
                <div class="">Created at @Vm.Report.CreatedAtUTC</div>
            </div>
        }
    }

    @if (Vm.Report == null && Vm.IsLoadedReportResult)
    {
        <div class="widget-missing-report-data">
            Missing report data!
        </div>
    }

    @if (!Vm.IsLoadedReportResult)
    {
        <div style="position:relative;">
            <div class="loading-bar"></div>
        </div>
    }

</div>

@code {

   protected override async Task OnInitializedAsync()
   {
      await Vm.RefreshReportResultData();

      //TODO filter report categories

      await base.OnInitializedAsync();
   }
}

<style>
    .widget-content-report-grid {
        padding: 15px;
        overflow: hidden;
    }

        .widget-content-report-grid h3 {
            text-align: center;
        }

    .widget-content-report-grid-footer {
        font-size: 12px;
        font-style: italic;
    }
</style>
