@namespace Orions.Systems.CrossModules.Pages
@page "/"

@inherits BaseOrionsComponent

@inject IMatToaster Toaster

<DashboardLayout 
                 Data="Data" 
                 AvailabelWidgets="AvailabaleWidgets"
                 EnableBetweenBox="true" 
                 Title="Dashboard Prototype"
                 OnSave="SaveChanges">
    
</DashboardLayout>

@code{

    private DashboardData Data { get; set; }

    private List<IDashboardWidget> AvailabaleWidgets { get; set; }

    protected override async Task OnInitializedAsync()
    {
        InitDashboard(); // load init data

        await base.OnInitializedAsync();
    }

    private void SaveChanges() {
        // Save dashboard data here

        ShowToaster(MatToastType.Success, "", "Save changes");
    }

    private void InitDashboard()
    {
        Data = new DashboardData();

        var row_1 = new DashboardRow();
        row_1.Columns.AddLast(new DashboardColumn { Size = 6, Widget = new SmartChartWidget() });
        row_1.Columns.AddLast(new DashboardColumn { Size = 6 });
        Data.Rows.AddLast(row_1);

        var row_2 = new DashboardRow();
        row_2.Columns.AddLast(new DashboardColumn { Size = 4 });
        row_2.Columns.AddLast(new DashboardColumn { Size = 4, Widget = new TagAnalyticChartWidget() });
        row_2.Columns.AddLast(new DashboardColumn { Size = 4 });
        Data.Rows.AddLast(row_2);

        AvailabaleWidgets = new List<IDashboardWidget> {
            new SmartChartWidget(),
            new TagAnalyticChartWidget(),
            new TagTreeMapWidget()
        };

    }

    private void ShowToaster(MatToastType type, string title, string message)
    {
        Toaster.Add(message, type, title, "", config =>
        {
            config.ShowCloseButton = false;
            config.ShowProgressBar = false;
            config.MaximumOpacity = 100;
        });
    }


    public class SmartChartWidget : DashboardWidgetBase, IDashboardWidget
    {
        public override string Label { get; set; } = "Smart Chart";
    }

    public class TagAnalyticChartWidget : DashboardWidgetBase, IDashboardWidget
    {
        public override string Label { get; set; } = "Tag Analytic Chart";
    }

    public class TagTreeMapWidget : DashboardWidgetBase, IDashboardWidget
    {
        public override string Label { get; set; } = "Tag Tree Map";
    }

}

<style>
    

</style>
