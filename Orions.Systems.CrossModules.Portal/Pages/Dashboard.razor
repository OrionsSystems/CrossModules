@namespace Orions.Systems.CrossModules.Portal.Pages
@page "/dashboard"

@using Orions.Infrastructure.HyperMedia
@using Orions.Infrastructure.Reporting
@using Orions.Node.Common

@inherits BaseOrionsComponent

@inject IMatToaster Toaster

<DashboardLayout Data="Data"
                 EnableBetweenBox="true"
                 IsPreviewMode="false"
                 DisableModeOption="false"
                 Title="Dashboard Prototype"
                 HyperStore="@HyperStore"
                 OnSave="SaveChanges">
</DashboardLayout>

@code{

    private DashboardData Data { get; set; }

    public IHyperArgsSink HyperStore { get; set; }

    protected override async Task OnInitializedAsync()
    {
        InitDashboard();

        HyperStore = await NetStore.ConnectAsyncThrows("http://gabe:g203040@usnbods01wan.orionscloud.com:8600/Execute");

        await base.OnInitializedAsync();
    }

    async Task SaveChanges()
    {
        // Save dashboard data here

        var doc = new HyperDocument(Data);

        var args = new StoreHyperDocumentArgs(doc);

        var res = await HyperStore.ExecuteAsync(args);

        var datas = await HyperStore.FindAllAsync<DashboardData>();

        ShowToaster(MatToastType.Success, "", "Save changes");
    }

    private void InitDashboard()
    {
        Data = new DashboardData();

        var row_1 = new DashboardRow();
        row_1.Columns.AddLast(new DashboardColumn { Size = 6 });
        row_1.Columns.AddLast(new DashboardColumn { Size = 6 });
        Data.Rows.AddLast(row_1);

        var row_2 = new DashboardRow();
        row_2.Columns.AddLast(new DashboardColumn { Size = 4 });
        row_2.Columns.AddLast(new DashboardColumn { Size = 4 });
        Data.Rows.AddLast(row_2);
    }

    private void ShowToaster(MatToastType type, string title, string message)
    {
        Toaster.Add(message, type, title, "", config =>
        {
            config.ShowCloseButton = false;
            config.ShowProgressBar = false;
            config.MaximumOpacity = 100;
        });
    }
}

<style>
    .top-row {
        display: none;
    }
</style>
