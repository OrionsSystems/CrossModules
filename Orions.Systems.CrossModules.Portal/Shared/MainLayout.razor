@inherits LayoutComponentBase
@using Orions.Systems.CrossModules.Portal.Providers
@using Syncfusion.EJ2.Blazor.SplitButtons
@using Syncfusion.EJ2.Blazor.Navigations
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<div class="control-section">
    <div class="col-lg-12 col-sm-12 col-md-12" id="sidebar-section">
        <div id="head">
            <div class="header">
                <div class="menu">
                    <img alt="image" class="img-circle" src="/image/orions-logo-sm.png">
                </div>
                <div class="right-content">
                    <AuthorizeView>
                        <Authorized>
                            <EjsDropDownButton Content="@context.User.Identity.Name">
                                <DropDownButtonEvents ItemSelected="OnItemSelected"></DropDownButtonEvents>
                                <DropDownButtonItems>
                                    <DropDownButtonItem Id="Logout" Text="Logout"></DropDownButtonItem>
                                </DropDownButtonItems>
                            </EjsDropDownButton>
                        </Authorized>
                    </AuthorizeView>
                </div>
            </div>
        </div>
        <EjsSidebar ID="dockSidebar" Type="Syncfusion.EJ2.Blazor.Navigations.SidebarType.Over" Target="#target" EnableDock="true" DockSize="60px">
            <ChildContent>
                <div class="content-area">
                    <div class="dock">
                        <NavMenu />
                    </div>
                </div>
            </ChildContent>
        </EjsSidebar>
        <div id="target">
            <div class="sidebar-content">
                @Body
            </div>
        </div>
    </div>
</div>

@code{
    private async Task Logout()
    {
        await ((CustomAuthenticationStateProvider)AuthenticationStateProvider).LogOut();

        NavigationManager.NavigateTo("/login");
    }

    public async Task OnItemSelected(Syncfusion.EJ2.Blazor.SplitButtons.MenuEventArgs args)
    {
        if (args.Element.ID.Equals("Logout", StringComparison.InvariantCultureIgnoreCase))
        {
            await Logout();
        }
    }
}
